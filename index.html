<!DOCTYPE html>
<html lang="pt-BR" id="html-lang">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title">VilorChat Premium</title>
  <script src="https://js.puter.com/v2/"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #6e48aa;
      --secondary: #9d50bb;
      --accent: #ff6b6b;
      --dark: #1a1a2e;
      --light: #f8f9fa;
      --success: #4CAF50;
      --warning: #FFC107;
      --error: #F44336;
      --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .card {
      background: white;
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.12);
    }
    
    h1, h2, h3 {
      color: var(--dark);
      font-weight: 600;
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    h2 {
      font-size: 1.8rem;
      margin-bottom: 20px;
      position: relative;
      display: inline-block;
    }
    
    h2::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 50px;
      height: 4px;
      background: var(--gradient);
      border-radius: 2px;
    }
    
    .language-selector {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }
    
    select {
      padding: 10px 15px;
      border-radius: 8px;
      border: 2px solid #e0e0e0;
      background: white;
      font-family: 'Poppins', sans-serif;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 1em;
    }
    
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(110, 72, 170, 0.2);
    }
    
    .tab-buttons {
      display: flex;
      margin-bottom: 25px;
      border-bottom: 2px solid #eee;
    }
    
    .tab-btn {
      padding: 12px 25px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      color: #666;
      position: relative;
      transition: all 0.3s;
    }
    
    .tab-btn:hover {
      color: var(--primary);
    }
    
    .tab-btn.active {
      color: var(--primary);
    }
    
    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--gradient);
      border-radius: 3px 3px 0 0;
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .tab-content.active {
      display: block;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 15px;
      margin-bottom: 20px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      transition: all 0.3s;
    }
    
    input:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(110, 72, 170, 0.2);
    }
    
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    button {
      background: var(--gradient);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(110, 72, 170, 0.3);
    }
    
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(110, 72, 170, 0.4);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    button.secondary {
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    
    button.secondary:hover {
      background: rgba(110, 72, 170, 0.05);
    }
    
    .media-container {
      margin-top: 30px;
      text-align: center;
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      background: #f9f9f9;
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    
    .media-container img {
      max-width: 100%;
      max-height: 600px;
      border-radius: 8px;
      margin: 0 auto;
      display: block;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    
    .media-container img:hover {
      transform: scale(1.02);
    }
    
    .loading {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    button .loading {
      border-top-color: var(--primary);
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    #chat-area {
      height: 400px;
      overflow-y: auto;
      border: 2px solid #e0e0e0;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 12px;
      background: white;
      scroll-behavior: smooth;
    }
    
    #chat-area::-webkit-scrollbar {
      width: 8px;
    }
    
    #chat-area::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    #chat-area::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }
    
    #chat-area::-webkit-scrollbar-thumb:hover {
      background: var(--secondary);
    }
    
    .message {
      margin-bottom: 15px;
      padding: 12px 18px;
      border-radius: 12px;
      max-width: 85%;
      position: relative;
      animation: messageIn 0.3s ease;
      line-height: 1.5;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    @keyframes messageIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .user-message {
      background: var(--gradient);
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }
    
    .bot-message {
      background: #f5f5f5;
      margin-right: auto;
      border-bottom-left-radius: 4px;
    }
    
    .error-message {
      color: var(--error);
      margin: 15px 0;
      padding: 10px;
      background: rgba(244, 67, 54, 0.1);
      border-radius: 8px;
      border-left: 4px solid var(--error);
    }
    
    .success-message {
      color: var(--success);
      margin: 15px 0;
      padding: 10px;
      background: rgba(76, 175, 80, 0.1);
      border-radius: 8px;
      border-left: 4px solid var(--success);
    }
    
    .info-message {
      color: var(--primary);
      margin: 15px 0;
      padding: 10px;
      background: rgba(110, 72, 170, 0.1);
      border-radius: 8px;
      border-left: 4px solid var(--primary);
    }
    
    .model-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .model-btn {
      padding: 10px 15px;
      border-radius: 8px;
      background: white;
      border: 2px solid #e0e0e0;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }
    
    .model-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }
    
    .model-btn.active {
      background: var(--gradient);
      color: white;
      border-color: var(--primary);
    }
    
    .media-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: center;
    }
    
    .media-actions button {
      padding: 8px 15px;
      font-size: 14px;
    }
    
    .tooltip {
      position: relative;
      display: inline-block;
    }
    
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: var(--dark);
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 14px;
      font-weight: normal;
    }
    
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .card {
        padding: 20px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      h2 {
        font-size: 1.5rem;
      }
      
      .tab-buttons {
        overflow-x: auto;
        white-space: nowrap;
        padding-bottom: 5px;
      }
      
      .message {
        max-width: 90%;
      }
      
      .media-container {
        min-height: 200px;
      }
    }
  </style>
</head>
<body>
  <div class="language-selector">
    <select id="language-select" onchange="changeLanguage()">
      <option value="pt">Português</option>
      <option value="ru">Русский</option>
      <option value="en">English</option>
      <option value="es">Español</option>
      <option value="zh">中文</option>
    </select>
  </div>

  <div class="container">
    <div class="card">
      <h1 id="main-title">VilorChat Premium</h1>
      <p id="main-subtitle">IA Avançada com Geradores de Imagem e Modelos de Linguagem</p>
    </div>

    <div class="card">
      <h2 id="llm-title">Chat com IA</h2>
      
      <div class="model-selector">
        <button class="model-btn active" data-model="openrouter:openai/gpt-3.5-turbo">GPT-3.5 Turbo</button>
        <button class="model-btn" data-model="openrouter:meta-llama/llama-3.1-8b-instruct">Llama 3 (8B)</button>
        <button class="model-btn" data-model="openrouter:anthropic/claude-3-haiku">Claude 3 Haiku</button>
      </div>
      
      <div id="chat-area"></div>
      
      <textarea id="user-input" placeholder="Digite sua mensagem..." data-placeholder-pt="Digite sua mensagem..." data-placeholder-ru="Введите ваше сообщение..." data-placeholder-en="Type your message..." data-placeholder-es="Escribe tu mensaje..." data-placeholder-zh="输入您的消息..."></textarea>
      
      <div style="display: flex; gap: 10px;">
        <button onclick="sendMessage()" id="send-btn">
          <i class="fas fa-paper-plane"></i> <span id="btn-text">Enviar</span>
          <span id="btn-loader" class="loading" style="display:none;"></span>
        </button>
        
        <button onclick="clearChat()" class="secondary">
          <i class="fas fa-trash"></i> <span id="clear-chat-text">Limpar</span>
        </button>
      </div>
    </div>

    <div class="card">
      <div class="tab-buttons">
        <button class="tab-btn active" onclick="openTab('images')" id="images-tab">
          <i class="fas fa-image"></i> <span id="images-tab-text">Imagens</span>
        </button>
      </div>

      <div id="images" class="tab-content active">
        <h2 id="images-title"><i class="fas fa-image"></i> Gerador de Imagens</h2>
        
        <select id="imageService">
          <option value="pollinations">1. Pollinations AI (IA Avançada)</option>
          <option value="unsplash">2. Unsplash (Fotos Reais HD)</option>
          <option value="picsum">3. Lorem Picsum (Placeholders)</option>
          <option value="placebeard">4. PlaceBeard (Divertido)</option>
          <option value="placekitten">5. PlaceKitten (Gatos)</option>
          <option value="placedog">6. PlaceDog (Cachorros)</option>
          <option value="fakeimg">7. FakeImg (Personalizado)</option>
          <option value="dummyimage">8. DummyImage (Simples)</option>
          <option value="picsum2">9. Picsum Photos (Aleatório)</option>
          <option value="placeholder">10. Placeholder (Básico)</option>
        </select>
        
        <div class="tooltip" style="width: 100%;">
          <input type="text" id="imagePrompt" placeholder="Descreva a imagem com detalhes..." data-placeholder-pt="Descreva a imagem com detalhes..." data-placeholder-ru="Подробно опишите изображение..." data-placeholder-en="Describe the image in detail..." data-placeholder-es="Describe la imagen en detalle..." data-placeholder-zh="详细描述图像...">
          <span class="tooltiptext">Seja o mais descritivo possível para melhores resultados</span>
        </div>
        
        <div style="display: flex; gap: 10px;">
          <button onclick="generateImage()" id="generate-image-btn">
            <i class="fas fa-magic"></i> <span id="generate-image-text">Gerar Imagem</span>
          </button>
          
          <button onclick="randomPrompt('image')" class="secondary">
            <i class="fas fa-random"></i> <span id="random-prompt-text">Aleatório</span>
          </button>
        </div>
        
        <div class="media-container" id="imageResult">
          <p id="image-placeholder"><i class="fas fa-image fa-3x" style="color: #e0e0e0; margin-bottom: 15px;"></i><br><span id="image-placeholder-text">Sua imagem aparecerá aqui</span></p>
        </div>
        
        <div class="media-actions" id="image-actions" style="display: none;">
          <button onclick="downloadMedia('image')" class="secondary">
            <i class="fas fa-download"></i> <span id="download-text">Baixar</span>
          </button>
          <button onclick="shareMedia('image')" class="secondary">
            <i class="fas fa-share-alt"></i> <span id="share-text">Compartilhar</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== CONFIGURAÇÕES ======
    const translations = {
      pt: {
        "main-title": "VilorChat Premium",
        "main-subtitle": "IA Avançada com Geradores de Imagem e Modelos de Linguagem",
        "llm-title": "Chat com IA",
        "images-title": "Gerador de Imagens",
        "btn-text": "Enviar",
        "clear-chat-text": "Limpar",
        "generate-image-text": "Gerar Imagem",
        "image-placeholder-text": "Sua imagem aparecerá aqui",
        "images-tab-text": "Imagens",
        "random-prompt-text": "Aleatório",
        "download-text": "Baixar",
        "share-text": "Compartilhar"
      },
      en: {
        "main-title": "VilorChat Premium",
        "main-subtitle": "Advanced AI with Image Generators and Language Models",
        "llm-title": "AI Chat",
        "images-title": "Image Generator",
        "btn-text": "Send",
        "clear-chat-text": "Clear",
        "generate-image-text": "Generate Image",
        "image-placeholder-text": "Your image will appear here",
        "images-tab-text": "Images",
        "random-prompt-text": "Random",
        "download-text": "Download",
        "share-text": "Share"
      },
      es: {
        "main-title": "VilorChat Premium",
        "main-subtitle": "IA avanzada con generadores de imágenes y modelos de lenguaje",
        "llm-title": "Chat con IA",
        "images-title": "Generador de Imágenes",
        "btn-text": "Enviar",
        "clear-chat-text": "Limpiar",
        "generate-image-text": "Generar Imagen",
        "image-placeholder-text": "Tu imagen aparecerá aquí",
        "images-tab-text": "Imágenes",
        "random-prompt-text": "Aleatorio",
        "download-text": "Descargar",
        "share-text": "Compartir"
      },
      ru: {
        "main-title": "VilorChat Premium",
        "main-subtitle": "Продвинутый ИИ с генераторами изображений и языковыми моделями",
        "llm-title": "Чат с ИИ",
        "images-title": "Генератор изображений",
        "btn-text": "Отправить",
        "clear-chat-text": "Очистить",
        "generate-image-text": "Создать изображение",
        "image-placeholder-text": "Здесь появится ваше изображение",
        "images-tab-text": "Изображения",
        "random-prompt-text": "Случайный",
        "download-text": "Скачать",
        "share-text": "Поделиться"
      },
      zh: {
        "main-title": "VilorChat Premium",
        "main-subtitle": "具有图像生成器和语言模型的高级AI",
        "llm-title": "AI聊天",
        "images-title": "图像生成器",
        "btn-text": "发送",
        "clear-chat-text": "清除",
        "generate-image-text": "生成图像",
        "image-placeholder-text": "您的图像将出现在这里",
        "images-tab-text": "图像",
        "random-prompt-text": "随机",
        "download-text": "下载",
        "share-text": "分享"
      }
    };

    // Serviços de Imagem com APIs públicas
    const imageServices = {
      pollinations: prompt => `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt || 'a beautiful landscape')}?width=800&height=500&nologo=true`,
      unsplash: prompt => `https://source.unsplash.com/800x500/?${prompt ? encodeURIComponent(prompt) : 'random'}`,
      picsum: () => `https://picsum.photos/800/500?random=${Math.random()}`,
      placebeard: () => `https://placebeard.it/800/500/${Math.random()}`,
      placekitten: () => `https://placekitten.com/800/500`,
      placedog: () => `https://placedog.net/800/500?random=${Math.random()}`,
      fakeimg: prompt => `https://fakeimg.pl/800x500/?text=${encodeURIComponent(prompt ? prompt.substring(0, 30) : 'Sample+Image')}`,
      dummyimage: prompt => `https://dummyimage.com/800x500/cccccc/000000&text=${encodeURIComponent(prompt ? prompt.substring(0, 30) : 'Sample+Image')}`,
      picsum2: () => `https://picsum.photos/800/500?image=${Math.floor(Math.random() * 1000)}`,
      placeholder: () => `https://via.placeholder.com/800x500.png?text=${encodeURIComponent("Sample+Image")}`
    };

    // Variáveis globais
    let currentLanguage = 'pt';
    let originalMessages = [];
    let isTranslating = false;

    // ====== FUNÇÕES PRINCIPAIS ======
    function changeLanguage() {
      const lang = document.getElementById('language-select').value;
      currentLanguage = lang;
      localStorage.setItem('language', lang);
      applyTranslations(lang);
      
      // Traduz o chat apenas se não for a primeira carga
      if (originalMessages.length > 0) {
        translateChat();
      }
    }

    function loadLanguage() {
      const savedLang = localStorage.getItem('language') || 'pt';
      currentLanguage = savedLang;
      document.getElementById('language-select').value = savedLang;
      applyTranslations(savedLang);
    }

    function applyTranslations(lang) {
      const translation = translations[lang] || translations['pt'];
      
      // Atualiza os textos estáticos
      Object.keys(translation).forEach(key => {
        const element = document.getElementById(key);
        if (element) {
          element.textContent = translation[key];
        }
      });
      
      // Atualiza placeholders
      const textareas = document.querySelectorAll('textarea, input[type="text"]');
      textareas.forEach(el => {
        const placeholderKey = el.getAttribute(`data-placeholder-${lang}`);
        if (placeholderKey) {
          el.placeholder = placeholderKey;
        }
      });
    }

    function openTab(tabName) {
      // Esconde todos os conteúdos de abas
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove a classe active de todos os botões
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Mostra a aba selecionada
      document.getElementById(tabName).classList.add('active');
      
      // Ativa o botão correspondente
      document.querySelector(`.tab-btn[onclick="openTab('${tabName}')"]`).classList.add('active');
    }

    // Envia mensagem para a IA
    async function sendMessage() {
      if (isTranslating) return;
      
      const userInput = document.getElementById('user-input');
      const message = userInput.value.trim();
      if (!message) return;

      // Salva a mensagem original
      originalMessages.push({
        text: message,
        sender: 'user'
      });
      
      addMessage(message, 'user');
      userInput.value = '';

      const model = document.querySelector('.model-btn.active').dataset.model;
      const btnText = document.getElementById('btn-text');
      const btnLoader = document.getElementById('btn-loader');

      btnText.style.display = 'none';
      btnLoader.style.display = 'inline-block';

      try {
        const response = await puter.ai.chat(message, { model: model });
        
        // Salva a resposta original
        originalMessages.push({
          text: response,
          sender: 'bot'
        });
        
        addMessage(response, 'bot');
        
        // Envia o histórico completo para o Puter
        await sendChatHistoryToPuter();
      } catch (error) {
        const errorMsg = "Erro ao conectar com a IA. Tente novamente.";
        originalMessages.push({
          text: errorMsg,
          sender: 'bot'
        });
        addMessage(errorMsg, 'bot');
        console.error("Erro no chat:", error);
      } finally {
        btnText.style.display = 'inline-block';
        btnLoader.style.display = 'none';
      }
    }

    // Envia o histórico do chat para o Puter
    async function sendChatHistoryToPuter() {
      try {
        const chatHistory = {
          messages: originalMessages,
          language: currentLanguage,
          timestamp: new Date().toISOString()
        };
        
        // Aqui você pode enviar o histórico para onde precisar no Puter
        // Por exemplo, salvando em um arquivo ou banco de dados
        console.log("Histórico do chat para Puter:", chatHistory);
        // await puter.fs.writeFile('/chat_history.json', JSON.stringify(chatHistory));
        
      } catch (error) {
        console.error("Erro ao enviar histórico para o Puter:", error);
      }
    }

    // Traduz o chat usando a API LibreTranslate
    async function translateChat() {
      if (isTranslating || originalMessages.length === 0) return;
      
      isTranslating = true;
      const chatArea = document.getElementById('chat-area');
      const lang = currentLanguage;
      
      try {
        // Limpa o chat area
        chatArea.innerHTML = '';
        
        // API LibreTranslate (pública)
        const LIBRE_TRANSLATE_API = "https://libretranslate.de/translate";
        
        // Traduz cada mensagem individualmente
        for (const msg of originalMessages) {
          if (lang === 'pt') {
            // Se for português, mostra o texto original
            addMessage(msg.text, msg.sender);
            continue;
          }
          
          try {
            const response = await fetch(LIBRE_TRANSLATE_API, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                q: msg.text,
                source: "auto",
                target: lang
              })
            });
            
            const data = await response.json();
            
            if (data.translatedText) {
              addMessage(data.translatedText, msg.sender);
            } else {
              // Se falhar, mostra o texto original
              addMessage(msg.text, msg.sender);
            }
          } catch (e) {
            console.error("Erro ao traduzir mensagem:", e);
            addMessage(msg.text, msg.sender);
          }
        }
      } catch (error) {
        console.error("Erro na tradução:", error);
        // Se falhar completamente, recria o chat com as mensagens originais
        chatArea.innerHTML = '';
        originalMessages.forEach(msg => {
          addMessage(msg.text, msg.sender);
        });
      } finally {
        isTranslating = false;
      }
    }

    // Gera imagem com base no prompt
    function generateImage() {
      const prompt = document.getElementById('imagePrompt').value;
      const service = document.getElementById('imageService').value;
      const resultDiv = document.getElementById('imageResult');

      resultDiv.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Gerando imagem...</p>';
      
      const img = document.createElement('img');
      img.src = imageServices[service](prompt);
      img.alt = prompt || "Imagem gerada";
      img.style.maxWidth = '100%';
      img.style.height = 'auto';
      
      img.onload = () => {
        resultDiv.innerHTML = '';
        resultDiv.appendChild(img);
        document.getElementById('image-actions').style.display = 'flex';
      };
      
      img.onerror = () => {
        resultDiv.innerHTML = '<p class="error-message"><i class="fas fa-exclamation-triangle"></i> Erro ao carregar a imagem. Tente outro serviço ou prompt.</p>';
      };
    }

    // Adiciona mensagem ao chat
    function addMessage(text, sender) {
      const chatArea = document.getElementById('chat-area');
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message', sender + '-message');
      messageDiv.textContent = text;
      chatArea.appendChild(messageDiv);
      chatArea.scrollTop = chatArea.scrollHeight;
    }

    // Limpa o chat
    function clearChat() {
      document.getElementById('chat-area').innerHTML = '';
      originalMessages = [];
      // Também limpa o histórico no Puter
      sendChatHistoryToPuter();
    }

    // Gera um prompt aleatório
    function randomPrompt(type) {
      const prompts = {
        image: [
          "Um pôr do sol sobre montanhas com reflexo no lago",
          "Gato astronauta no espaço com estrelas ao fundo",
          "Cidade futurista com arranha-céus brilhantes",
          "Praia tropical com coqueiros e mar azul cristalino",
          "Floresta encantada com luzes de fadas e cogumelos gigantes"
        ]
      };
      
      const promptField = 'imagePrompt';
      const randomIndex = Math.floor(Math.random() * prompts[type].length);
      document.getElementById(promptField).value = prompts[type][randomIndex];
    }

    // Baixa a mídia gerada
    function downloadMedia(type) {
      const container = 'imageResult';
      const element = document.getElementById(container).querySelector('img');
      
      if (!element) return;
      
      const url = element.src;
      const a = document.createElement('a');
      a.href = url;
      a.download = `vilorchat-${type}-${new Date().getTime()}.jpg`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    // Compartilha a mídia gerada
    function shareMedia(type) {
      const container = 'imageResult';
      const element = document.getElementById(container).querySelector('img');
      
      if (!element) return;
      
      const url = element.src;
      
      if (navigator.share) {
        navigator.share({
          title: `VilorChat ${type === 'image' ? 'Image' : 'Video'}`,
          text: `Confira esta ${type === 'image' ? 'imagem' : 'vídeo'} gerada pelo VilorChat`,
          url: url
        }).catch(err => {
          console.log('Erro ao compartilhar:', err);
        });
      } else {
        // Fallback para copiar o link
        navigator.clipboard.writeText(url).then(() => {
          alert("Link copiado para a área de transferência!");
        });
      }
    }

    // Seleciona modelo de IA
    document.querySelectorAll('.model-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.model-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
      });
    });

    // Inicialização
    document.addEventListener('DOMContentLoaded', () => {
      loadLanguage();
      
      // Permite enviar mensagem com Enter
      document.getElementById('user-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });
      
      // Exemplo de mensagem inicial
      setTimeout(() => {
        const welcomeMsg = "Olá! Sou o VilorChat, como posso ajudar você hoje?";
        originalMessages.push({
          text: welcomeMsg,
          sender: 'bot'
        });
        addMessage(welcomeMsg, 'bot');
      }, 1000);
    });
  </script>
</body>
</html>
